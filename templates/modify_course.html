<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生成绩管理系统</title>
    <link rel="icon" href="../favicon.ico">
    <link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../static/css/main.css" />

    <script>

        function selectCourses(schoolSelectId, courseSelectId) {
            var schoolSelect = document.getElementById(schoolSelectId);
            var courseSelect = document.getElementById(courseSelectId);

            // 清空第二个下拉框的选项
            courseSelect.innerHTML = '';

            // 根据第一个下拉框的选择动态加载选项
            switch (schoolSelect.value) {
                case "自然科学学院":
                    var courses = [
                        '环境科学概论', '地球科学前沿', '生物信息学', '材料科学导论', '物理化学实验',
                        '生物技术与工程', '天文学与宇宙探索', '海洋科学探索', '可持续发展科学', '交叉科学研究方法'
                    ];
                    break;

                case "人文社科学院":
                    var courses = [
                        '摄影艺术与技术', '摄影史与文化', '园艺学原理与实践', '园林设计与规划', '社会学导论',
                        '性别社会学', '劳动与工业社会学', '世界历史概论', '中国古代史', '近现代国际关系史',
                        '民俗学与文化传承', '非物质文化遗产保护', '地理学基础', '人文地理学', '区域地理研究'
                    ];
                    break;

                case "暂无":
                    var courses = ['暂无'];
                    break;
            }


            // 将加载的选项添加到第二个下拉框中
            courses.forEach(function(course) {
                var option = document.createElement('option');
                option.text = course;
                option.value = course;
                courseSelect.add(option);
            });
        }


        // 不修改按钮点击事件处理函数
        function handleNoModify() {
            window.location.href = "/student_courses";
        }


        function showModifyForm(event) {
            event.preventDefault(); // 阻止第一个表单的默认提交行为

            // 显示第二个表单中的文本框所在的div
            var modifyForm = document.getElementById('modify-form');
            modifyForm.style.display = 'block';

            // 获取第一个表单中的stu_id值
            var stuId = document.getElementById('modifyForm').querySelector('input[name="stu_id"]').value;

            // 将stu_id的值设置到第二个表单的隐藏字段中
            var stuIdHidden = document.getElementById('stu_id_hidden');
            if (stuIdHidden) {
                stuIdHidden.value = stuId;
            } else {
                console.error('无法找到stu_id的隐藏字段');
            }
        }

    </script>
</head>

<body>
    <div class="container">
        <div class="header">
            <span class="left">汉 东 大 学 学 生 信 息 管 理 系 统</span>
            <span class="right">你 好，{{user_info}}管 理 员!</span>
            <span class="right_right"><a href="/">退出登陆</a></span>
        </div>
        <div class="leftside">
        <ul>
            <li><a href="/student_view">学生信息查询</a></li>
            <li><a href="/student">学生信息录入</a></li>
            <li><a href ="/update_student">学生信息删改</a></li>
            <li><a href="/teacher_class">老师开设课程查看</a></li>
            <li class="first"><a href="/student_courses">学生选课管理</a></li>
            <li><a href="/score_infos">学生成绩</a></li>
            <li><a href="/graduation">毕业学生去向</a></li>
            <li><a href="/dataAnalysis">数据分析</a></li>
            <li><a href="/adminstator">系统管理员变动</a></li>
        </ul>
        </div>
        <div class="container-fluid">
            <h1 class="sub-header center">学 生 信 息 删 改 系 统</h1>
            <div class="table-responsive">
                <table class="table table-striped">
                    <!-- 查询结果展示 -->
                    {% if query_conditions or query_results %}
                    <table class="table table-striped student-table">
                        <!-- 表头 -->
                        <thead>
                            <tr>
                                <th style="width: 9%;">学号</th>
                                <th style="width: 6%;">姓名</th>
                                <th style="width: 4%;">性别</th>
                                <th style="width: 6%;">年级</th>
                                <th style="width: 14%;">学院</th>
                                <th style="width: 14%;">专业班级</th>
                                <th style="width: 12%;">选修课程1</th>
                                <th style="width: 12%;">选修课程2</th>
                                <th style="width: 12%;">选修课程3</th>
                                <th style="width: 8%;">操作</th>
                            </tr>
                        </thead>
                        <!-- 查询结果展示 -->
                        {% if query_results %}
                        <!-- 遍历查询结果 -->
                        {% for result in query_results %}
                        <tr>
                            <!-- 列数据 -->
                            <td>{{ result[0] }}</td>
                            <td>{{ result[1] }}</td>
                            <td>{{ result[2] }}</td>
                            <td>{{ result[3] }}</td>
                            <td>{{ result[4] }}</td>
                            <td>{{ result[5] }}</td>
                            <td>{{ result[6] }}</td>
                            <td>{{ result[7] }}</td>
                            <td>{{ result[8] }}</td>
                            <td>
                                <!-- 修改按钮 -->
                                <form id="modifyForm" action="/modify_course" method="post" style="display: inline-block; margin-right: 5px;">
                                    <input type="hidden" name="stu_id" value="{{ result[0] }}">
                                    <input type="hidden" name="course_name" value="{{ result[6] }}">
                                    <input type="submit" value="确认修改" class="btn-modify" onclick="showModifyForm(event)">
                                </form>
                                <form action="/student_courses" method="post" onsubmit="return false;">
                                    <input type="submit" value="放弃修改" class="btn-delete" onclick="handleNoModify()">
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <!-- 如果查询结果为空 -->
                        <p style="color: red; font-weight: bold;">抱歉，系统中没有找到符合您要求的结果！</p>
                        {% endif %}
                    </table>
                    {% endif %}
                    <form action="/modify_course" method="post">
                        <div id="modify-form" style="display: none;">
                            <div class="form-group">
                                <div class="form-row">
                                    <label class="comment-label">请修改选课信息：</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-row">
                                    <label class="name-label start-label" for="test_score">选修课程1：</label>
                                        <select class="long college-label start-label" id="schoolSelect1" name="course_school" onchange="selectCourses('schoolSelect1','courseSelect1')">
                                            <option value="" disabled selected>请选择开课学院</option>
                                            <option value="暂无">暂无</option>
                                            <option value="自然科学学院">自然科学学院</option>
                                            <option value="人文社科学院">人文社科学院</option>
                                        </select>
                                        <select class="long college-label start-label" id="courseSelect1" name="stu_course1" >
                                                <option value="" disabled selected>请选择选修课程</option>
                                        </select>
                                </div>
                                <div class="form-row">
                                    <label class="name-label start-label" for="test_score">选修课程2：</label>
                                        <select class="long college-label start-label" id="schoolSelect2" name="course_school" onchange="selectCourses('schoolSelect2','courseSelect2')">
                                            <option value="" disabled selected>请选择开课学院</option>
                                            <option value="暂无">暂无</option>
                                            <option value="自然科学学院">自然科学学院</option>
                                            <option value="人文社科学院">人文社科学院</option>
                                        </select>
                                        <select class="long college-label start-label" id="courseSelect2" name="stu_course2" >
                                                <option value="" disabled selected>请选择选修课程</option>
                                        </select>
                                </div>
                                <div class="form-row">
                                    <label class="name-label start-label" for="test_score">选修课程3：</label>
                                        <select class="long college-label start-label" id="schoolSelect3" name="course_school" onchange="selectCourses('schoolSelect3','courseSelect3')">
                                            <option value="" disabled selected>请选择开课学院</option>
                                            <option value="暂无">暂无</option>
                                            <option value="自然科学学院">自然科学学院</option>
                                            <option value="人文社科学院">人文社科学院</option>
                                        </select>
                                        <select class="long college-label start-label" id="courseSelect3" name="stu_course3" >
                                                <option value="" disabled selected>请选择选修课程</option>
                                        </select>
                                </div>
                            </div>
                            <div>
                                <input type="hidden" name="stu_id" id="stu_id_hidden">
                                <input class="submit-btn-right" type="submit" value="提交修改">
                            </div>
                        </div>
                    </form>
                </table>
            </div>
        </div>
    </div>
</body>

</html>